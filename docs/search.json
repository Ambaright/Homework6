[
  {
    "objectID": "Writing R Functions and API Query.html",
    "href": "Writing R Functions and API Query.html",
    "title": "Writing R Functions and API Query",
    "section": "",
    "text": "Task 1: Conceptual Questions\nOn the exam, you’ll be asked to explain some topics. How about some practice?! Create a markdown list with the following questions:\n1. What is the purpose of the lapply() function? What is the equivalent purrr function?\nThe lapply() function allows the programmer to apply functions to lists, in that the specified function is applied to each list element. The equivalent purrr function is map(), where this function will always return a list and has the 1st argument be a list and the second the function to use.\n2. Suppose we have a list called my_list. Each element of the list is a numeric data frame (all columns are numeric). We want use lapply() to run the code cor(numeric_matrix, method = \"kendall\") on each element of the list. Write code to do this below! (I’m really trying to ask you how you specify method = \"kendall\" when calling lapply())\nresult &lt;- lapply(X = my_list, FUN = cor, method = \"kendall\")\n3. What are two advantages of using purrr functions instead of the BaseR apply family?\nThe purrr functions are a tidyverse alternative to the BaseR apply family. The main advantage of using these functions is more consistency and some additional helper functions.\n4. What is a side-effect function?\nThere are two types of pipeable functions: transformations and side effects. We’re used to working with transformations that naturally return the modified arguement (like a data frame). A side-effect function is a function that does not return the modified argument, and thus makes it difficult to keep using the modified argument in future piping code.\n5. Why can you name a variable sd in a function and not cause any issues with the sd function?\nWhen we call a function, it creates a temporary function environment. This temporary function environment allows you to have variables with the same name in a function and in your global environment. Thus the variable sd in the function is a temporary variable that does not interfer with the global environment’s sd() function.\n\n\nTask 2: Writing R Functions\n\nWhen we start doing machine learning later in the course, a common metric used to evaluate predictions is called Root Mean Square Error (RMSE). Write a basic function (call it getRMSE()) that takes in a vector of responses and a vector of predictions and outputs the RMSE.\n\n\nIf a value is missing for the vector of responses (i.e. an NA is present), allow for additional arguments to the mean() function (elipses) that removes the NA values in the computation.\n\n\ngetRMSE &lt;- function(response_vector, prediction_vector, ...){\n  rmse &lt;- sqrt(mean(response_vector - prediction_vector, ...)^2)\n  \n  return(rmse)\n}\n\n\nRun the following code to create some response values and predictions.\n\n\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10 * x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n\nTest your RMSE function using this data.\n\n\ngetRMSE(resp, pred)\n\n[1] 9.636992e-16\n\n\n\nRepeat after replacing two of the response values with missing values (NA_real_).\n\n\nresp[2] &lt;- NA_real_\nresp[4] &lt;- NA_real_\n\n– Test your RMSE function with and without specifying the behavior to deal with missing values.\nTesting without specifying na.rm = TRUE.\n\ngetRMSE(resp, pred)\n\n[1] NA\n\n\nTesting with specifying na.rm = TRUE.\n\ngetRMSE(resp, pred, na.rm = TRUE)\n\n[1] 0.01697111\n\n\n\nAnother common metric for evaluating predictions is mean absolute deviation. Write a function called getMAE() that follows the specifications of the getRMSE() function.\n\n\ngetMAE &lt;- function(response_vector, prediction_vector, ...){\n  mae &lt;- mean(abs(response_vector - prediction_vector), ...)\n  \n  return(mae)\n}\n\n\nRun the following code to create some response values and predictions.\n\n\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10 * x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n\nTest your MAE function using this data.\n\n\ngetMAE(resp, pred)\n\n[1] 0.8155776\n\n\n\nRepeat after replacing two of the response values with missing values (NA_real_)\n\n\nresp[2] &lt;- NA_real_\nresp[4] &lt;- NA_real_\n\n– Test your MAE function with and without specifying the behavior to deal with missing values.\nTest the MAE function without specifying na.rm = TRUE.\n\ngetMAE(resp, pred)\n\n[1] NA\n\n\nTest the MAE function with specifying na.rm = TRUE.\n\ngetMAE(resp, pred, na.rm = TRUE)\n\n[1] 0.8087196\n\n\n\nLet’s create a wrapper function that can be used to get either or both metrics returned with a single function call. Do not rewrite your above two functions, call them inside the wrapper function (we would call the getRMSE() and getMAE() functions helper functions). When returning your values, give them appropriate names.\n\n\nThe function should check that two numeric (atomic) vectors have been passed (consider is.vector(), is.atomic(), and is.numeric()). If not, a message should print and the function should exit.\nThe function should return both metrics by default and include names. The behavior should be able to be changed using a character string of metrics to find.\n\n\ngetMetrics &lt;- function(resp_vector, pred_vector, metrics = c(\"RMSE\", \"MAE\"), ...){\n  \n  #Check that resp_vector is a numeric (atomic) vector\n  if(!(is.vector(resp_vector) && is.atomic(resp_vector) && is.numeric(resp_vector))) {\n    stop(\"Response vector provided is not a numeric (atomic) vector.\")\n  }\n  \n  #Check that pred_vector is a numeric (atomic) vector\n  if(!(is.vector(pred_vector) && is.atomic(pred_vector) && is.numeric(pred_vector))) {\n    stop(\"Predictor vector provided is not a numeric (atomic) vector.\")\n  }\n  \n  results &lt;- list()\n  \n  if(\"RMSE\" %in% metrics){\n    results$RMSE &lt;- getRMSE(resp_vector, pred_vector, ...)\n  }\n\n  if(\"MAE\" %in% metrics){\n    results$MAE &lt;- getMAE(resp_vector, pred_vector, ...)\n  }  \n\n  return(results)  \n}\n\n\nRun the following code to create some response values and predictions.\n\n\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10 * x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n\nTest your new function using this data. Call it once asking for each metric individually and once specifying both metrics.\n\n\n#Specifying RMSE\ngetMetrics(resp, pred, metrics = \"RMSE\")\n\n$RMSE\n[1] 9.636992e-16\n\n\n\n#Specifying MAE\ngetMetrics(resp, pred, metrics = \"MAE\")\n\n$MAE\n[1] 0.8155776\n\n\n\n#Specifying RMSE and MAE\ngetMetrics(resp, pred, metrics = c(\"RMSE\", \"MAE\"))\n\n$RMSE\n[1] 9.636992e-16\n\n$MAE\n[1] 0.8155776\n\n\n\nRepeat with replacing two of the response values with missing values (NA_real_).\n\n\n#Replace two of the response values with missing values\nresp[2] &lt;- NA_real_\nresp[4] &lt;- NA_real_\n\n\n#Repeat specifying RSME without specifying na.rm = TRUE\ngetMetrics(resp, pred, metrics = \"RMSE\")\n\n$RMSE\n[1] NA\n\n\n\n#Repeat specifying MAE with specifying na.rm = TRUE\ngetMetrics(resp, pred, metrics = \"MAE\", na.rm = TRUE)\n\n$MAE\n[1] 0.8087196\n\n\n\n#Repeat specifying RSME and MAE without specifying na.rm = TRUE\ngetMetrics(resp, pred, metrics = c(\"RMSE\", \"MAE\"))\n\n$RMSE\n[1] NA\n\n$MAE\n[1] NA\n\n\n\n\nTask 3: Querying an API and a Tidy-Style Function\nFor this section, you’ll connect to the news API here: newsapi.org.\n\nUse GET() from the httr package to return information about a topic that you are interested in that has been in the news lately (store the result as an R object). Note: We can only look 30 days into the past with a free account.\n\nFor this task, let’s look at information related to hurricanes.\n\nlibrary(jsonlite)\n\nWarning: package 'jsonlite' was built under R version 4.3.3\n\nlibrary(httr)\nlibrary(tidyverse)\n\nWarning: package 'tidyverse' was built under R version 4.3.3\n\n\nWarning: package 'ggplot2' was built under R version 4.3.3\n\n\nWarning: package 'tidyr' was built under R version 4.3.3\n\n\nWarning: package 'stringr' was built under R version 4.3.3\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter()  masks stats::filter()\n✖ purrr::flatten() masks jsonlite::flatten()\n✖ dplyr::lag()     masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nurl_hurricanes &lt;- \"https://newsapi.org/v2/everything?q=hurricane&apiKey=065b6930902c4950902e45df34a5a107\"\n\nhurricanes_info &lt;- httr::GET(url_hurricanes)\n\n\nParse what is returned and find your way to the data frame that has the actual article information in it (check content). Use the pluck() function from purrr to grab the articles element. Note the first column should be a list column!\n\n\nhurricanes_info &lt;- hurricanes_info |&gt;\n  content(\"text\") |&gt;\n  fromJSON(simplifyDataFrame = TRUE) |&gt;\n  purrr::pluck(\"articles\")\n\n\nNow write a quick function that allows the user to easily query this API. The inputs to the function should be the title/subject to search for (string), a time period to search from (string - you’ll search from that time until the present), and an API key.\n\nFor this function, we will need to be sure that the “from_date” is in the “YYYY-MM-DD” format.\n\nquery_news_api &lt;- function(subject, from_date, api_key){\n  base_url &lt;- \"https://newsapi.org/v2/everything\"\n  \n  url &lt;- paste0(base_url, \"?q=\", subject, \"&from=\", from_date, \"&apiKey=\", api_key)\n  \n  query_info &lt;- httr::GET(url) |&gt;\n    content(\"text\") |&gt;\n    fromJSON(simplifyDataFrame = TRUE) |&gt;\n    purrr::pluck(\"articles\")\n  \n  return(query_info)\n}\n\nUse your function twice to grab some data (save each as an object)!\nFirst we can grab some data on Hurricane Helene from the day before it made landfall in North Carolina (2024-09-25).\n\nmy_api_key &lt;- \"065b6930902c4950902e45df34a5a107\"\nhurricane_helene_info &lt;- query_news_api(\"hurricane_helene\", \"2024-09-25\", my_api_key)\nhead(hurricane_helene_info)\n\n  source.id         source.name                     author\n1      &lt;NA&gt;     Politicopro.com Ariel Wittenberg, E&E News\n2      &lt;NA&gt;     Consequence.net                Mary Siroky\n3      &lt;NA&gt;     Livejournal.com              robertsbox_xo\n4      &lt;NA&gt;     TheStranger.com            Nathalie Graham\n5      &lt;NA&gt; Nakedcapitalism.com           Lambert Strether\n6      &lt;NA&gt;            TechSpot              Jimmy Pezzone\n                                                                                                                          title\n1                                    Hurricanes Helene’s Floods Swamped a Hospital, Highlighting Climate Threats to Health Care\n2                                                                   Taylor Swift Donates $5 Million to Hurricane Relief Efforts\n3                                                 Taylor Swift Donates $5 Million to Hurricane Helene and Milton Relief Efforts\n4 Slog AM: Yakima Coroner Allegedly Stole Drugs from Dead People, Mariners Playoff Dreams Are Dead, and So Is Dame Maggie Smith\n5                                                                                                               Links 9/28/2024\n6                                              How engineering saved Tampa General Hospital from Hurricane Helene's storm surge\n                                                                                                                                                                                                                                                                 description\n1                                                                                                                         Hurricane Helene forced dozens of medical facilities across the southern U.S. to evacuate patients, underscoring the human costs of climate change\n2                                                                                                 The donation will support rebuilding efforts, community recovery, and clean water distribution. \\nTaylor Swift Donates $5 Million to Hurricane Relief Efforts\\nMary Siroky\n3         Thank you, @taylorswift13, for standing with us in the movement to end hunger and helping communities in need in the wake of #HurricaneHelene and #HurricaneMilton.  Join Taylor if you're able by donating here: https://t.co/rSpfqPuHCv pic.twitter.com/NYJIIG3…\n4 The Stranger's morning news roundup.\\n \\n by Nathalie Graham\\n \\n \\n \\n RIP Mariners' hopes and dreams: If you're a Mariners fan, this news is unsurprising to you. The team failed to make it to the playoffs, once again missing the postseason despite a season filled…\n5                                                                                                                                                                                                                                                    Our oceanic daily links\n6       Tampa General Hospital, the region's only level one trauma center, is situated on Davis Island, just a stone's throw from the bay. With no safe option to relocate patients before Hurricane Helene's arrival, the hospital had no choice but to prepare to weather…\n                                                                                                                                                                                 url\n1                                                 https://subscriber.politicopro.com/article/eenews/2024/10/02/a-dangerous-rescue-helene-made-a-hospital-almost-inescapable-00181734\n2                                                                                                            https://consequence.net/2024/10/taylor-swift-hurricane-relief-donation/\n3                                                                                                                               https://ohnotheydidnt.livejournal.com/129333710.html\n4 https://www.thestranger.com/slog-am/2024/09/27/79714396/slog-am-yakima-coroner-allegedly-stole-drugs-from-dead-people-mariners-playoff-dreams-are-dead-and-so-is-dame-maggie-smith\n5                                                                                                                       https://www.nakedcapitalism.com/2024/09/links-9-28-2024.html\n6                                                                            https://www.techspot.com/news/104912-how-engineering-saved-tampa-general-hospital-hurricane-helene.html\n                                                                                                                                       urlToImage\n1 https://static.scientificamerican.com/dam/m/788f5ca12be8ef0f/original/Flood-damage-and-construction-vehicles-during-hurricane-Helene.jpg?w=1200\n2                                                                            https://consequence.net/wp-content/uploads/2024/10/Taylor-Swift.jpeg\n3                                                                            https://l-files.livejournal.net/og_image/3616053/505209?v=1728514811\n4                                               https://media1.fdncms.com/stranger/imager/u/large/79714531/stranger_mariners-wide-james_yates.jpg\n5                                                                         https://www.nakedcapitalism.com/wp-content/uploads/2024/09/Sunfish2.jpg\n6                                                                  https://www.techspot.com/images2/news/bigimage/2024/09/2024-09-28-image-18.jpg\n           publishedAt\n1 2024-10-02T18:45:00Z\n2 2024-10-09T21:33:24Z\n3 2024-10-09T22:57:07Z\n4 2024-09-27T15:32:00Z\n5 2024-09-28T10:58:12Z\n6 2024-09-29T14:32:00Z\n                                                                                                                                                                                                                     content\n1    CLIMATEWIRE | A dramatic helicopter evacuation of a Tennessee hospital Friday, as raging floodwaters from Hurricane Helene surrounded the building, underscores what health experts say are rising dang… [+10846 chars]\n2     Taylor Swift has made a major donation to non-profit organization Feeding America to aid in recovery efforts from Hurricanes Helene and Milton. According to Feeding America CEO Claire Babineaux-Fonte… [+1367 chars]\n3    Thank you, @taylorswift13, for standing with us in the movement to end hunger and helping communities in need in the wake of #HurricaneHelene and #HurricaneMilton. \\r\\nJoin Taylor if you're able by don… [+851 chars]\n4     RIP Mariners' hopes and dreams: If you're a Mariners fan, this news is unsurprising to you. The team failed to make it to the playoffs, once again missing the postseason despite a season filled with … [+5943 chars]\n5 Penguin chicks survive tearaway iceberg BBC\\r\\nFannie and Freddie: Single Family Serious Delinquency Rate Ticked Up in August Calculated Risk\\r\\nNobody Knows Anything, The Beatles edition The Big Picture… [+6573 chars]\n6     In a nutshell: Not much can stop Mother Nature once a hurricane forms. Torrential rain, high winds, and floodwaters threaten to destroy everything in their path, often leaving those in a storm's way … [+3021 chars]\n\n\nOur second query can be on college football from this last week.\n\ncollege_football_info &lt;- query_news_api(\"college_football\", \"2024-09-16\", my_api_key)\nhead(college_football_info)\n\n  source.id      source.name         author\n1        NA Knowyourmeme.com     Owen Carry\n2        NA  Shiftdelete.net   Yiğit Gençer\n3        NA         BroBible    Jacob Elsey\n4        NA         BroBible    Jacob Elsey\n5        NA         BroBible    Jacob Elsey\n6        NA         BroBible Clay Sauertieg\n                                                                                                                   title\n1 What Is 'Minecraft College Football?' Pig State, Ole Moo And Other Minecraft-Themed Universities From TikTok Explained\n2                                                       EA’nın spor oyunları için mobil sosyal ortam uygulaması geliyor!\n3                                                       Travis Hunter Dismisses Richard Sherman’s Take On His NFL Future\n4                                                NFL WR Says 17-Year-Old Ryan Williams Could Go Pro Next Year If Allowed\n5                      SEC Refs Double Down On Controversial Rulings After South Carolina Football’s Demands For Clarity\n6                           Alabama Wide Receiver Ryan Williams Causes Controversy With ‘Kill Everybody’ Message On Face\n                                                                                                                                                                                                                                                           description\n1                                                                                                                                                                     Minecraft College Football is the latest TikTok trend for both sports and Minecraft enthusiasts.\n2                                                     EA, bünyesinde barındırdığı spor oyunları hakkında gündem takibi ve özet bilgiler için EA Sports adında bir uygulama geliştirdiğini duyurdu.\\n\\nEA’nın spor oyunları için mobil sosyal ortam uygulaması geliyor!\n3 Richard Sherman recently appeared on the St. Brown Podcast to discuss football with the college and NFL seasons fully underway. Travis Hunter became a topic of conversation at one point in Sherman’s discussion. The former pro defensive back was asked about Hu…\n4 Alabama Crimson Tide wide receiver Ryan Williams put the college football world on notice with an insane performance against Georgia last Saturday. Deebo Samuel believes he could do the same in the NFL next year if it were allowed. The San Franciso pass catch…\n5 The South Carolina football team was upset with a handful of calls in its loss to LSU on Saturday which they believe directly affected the outcome of the contest. Included in those controversial rulings were a pair of negated pick-sixes and a phantom offensiv…\n6 Alabama wide receiver Ryan Williams is one of the country’s top freshman regardless of positions. But Williams caused a controversy on Saturday night when fans realized that his facetape for the Crimson Tide’s game against Georgia had the message “kill everyb…\n                                                                                                                                                            url\n1 https://knowyourmeme.com/editorials/guides/what-is-minecraft-college-football-pig-state-ole-moo-and-other-minecraft-themed-universities-from-tiktok-explained\n2                                                                                                    https://shiftdelete.net/ea-sports-mobil-uygulama-tanitildi\n3                                                                                 https://brobible.com/sports/article/travis-hunter-richard-sherman-nfl-future/\n4                                                                                               https://brobible.com/sports/article/ryan-williams-one-and-done/\n5                                                                                https://brobible.com/sports/article/sec-refs-south-carolina-football-response/\n6                                                                       https://brobible.com/sports/article/alabama-wide-receiver-ryan-williams-kill-everybody/\n                                                                    urlToImage\n1         https://i.kym-cdn.com/editorials/icons/original/000/010/452/mcaa.jpg\n2 https://ares.shiftdelete.net/2024/09/ea-sports-mobil-uygulama-tanitildi.webp\n3          https://brobible.com/wp-content/uploads/2024/09/travis-hunter-7.jpg\n4          https://brobible.com/wp-content/uploads/2024/10/ryan-williams-1.jpg\n5           https://brobible.com/wp-content/uploads/2024/09/shane-beamer-5.jpg\n6                       https://brobible.com/wp-content/uploads/2024/09/RW.jpg\n           publishedAt\n1 2024-10-15T16:00:48Z\n2 2024-09-17T21:09:14Z\n3 2024-09-26T15:16:29Z\n4 2024-10-02T17:43:53Z\n5 2024-09-17T22:09:26Z\n6 2024-09-29T03:09:39Z\n                                                                                                                                                                                                                     content\n1   There's a new TikTok trend that combines Minecraft and college football. Of course, it's called Minecraft College Football, or the MCAA for short.\\r\\nMinecraft builders have fabricated a bunch of fake … [+1993 chars]\n2     EA Sports FC (FIFA), NBA Live, Need for Speed, The Sims ve Battlefield serisi gibi birçok oyunun yapmcln yapan Electronic Arts (EA), bünyesinde barndrd spor oyunlar için kullanclarn sevdii takmlardan… [+1741 chars]\n3   Getty Image\\r\\nRichard Sherman recently appeared on the St. Brown Podcast to discuss football with the college and NFL seasons fully underway. Travis Hunter became a topic of conversation at one point … [+2200 chars]\n4   Getty Image\\r\\nAlabama Crimson Tide wide receiver Ryan Williams put the college football world on notice with an insane performance against Georgia last Saturday. Deebo Samuel believes he could do the … [+1930 chars]\n5   Getty Image\\r\\nThe South Carolina football team was upset with a handful of calls in its loss to LSU on Saturday which they believe directly affected the outcome of the contest. Included in those contr… [+2245 chars]\n6 Getty Image\\r\\nAlabama wide receiver Ryan Williams is one of the country’s top freshman regardless of positions.\\r\\nBut Williams caused a controversy on Saturday night when fans realized that his facetap… [+1925 chars]\n\n\n\nWith one of your objects, summarize the name of the source for each article. That is, find a one-way contingency table for this information.\n\n\ntable(hurricane_helene_info$source$name)\n\n\n                   [Removed]            Alphafreepress.gr \n                           2                            2 \n              Breitbart News                     BroBible \n                           1                            2 \n              Celebitchy.com            Checkyourfact.com \n                           1                            2 \n               Common Dreams              Consequence.net \n                           1                            1 \n                    Fox News             Freerepublic.com \n                           1                           27 \n                   Heavy.com               Hollywood Life \n                           1                            1 \n            Inside the Magic International Business Times \n                           3                            1 \n               Investing.com            Korrespondent.net \n                           2                            2 \n       Legalinsurrection.com                 Livedoor.com \n                           1                            1 \n             Livejournal.com              Naftemporiki.gr \n                           1                            1 \n         Nakedcapitalism.com                    Newsit.gr \n                           2                            3 \n                    Newsweek                       PEOPLE \n                           5                            1 \n             Politicopro.com                  Queerty.com \n                           1                            1 \n                     Skai.gr                   Snopes.com \n                           2                            1 \n                    TechSpot                The Daily Dot \n                           1                            4 \n        Thegatewaypundit.com    Thegatewithbriancohen.com \n                           2                            1 \n             TheStranger.com           Westernjournal.com \n                           1                            1 \n      Whyevolutionistrue.com                   WISHTV.com \n                           1                            1 \n\n\n\nFor each of your returned data objects, turn the publishedAt column into a date column using the lubridate package (see the PARSE DATE-TIMES section of the cheat sheet!).\n\n\nThen sort the two data frames, each by their new parsed date published column.\nFinally, create a new variable called pub_diff that is the difference in time between the articles’ published dates (use lag() with mutate()). Save the modifications as new data frames.\n\n\nlibrary(lubridate)\n\n#A function to modify the data objects with the required specifications\nmodify_query_df &lt;- function(df){\n  \n  df &lt;- df |&gt;\n    mutate(publishedAt = ymd_hms(publishedAt)) |&gt;\n    arrange(publishedAt) |&gt;\n    mutate(pub_diff = as.numeric(difftime(publishedAt, lag(publishedAt), units = \"mins\")))\n  \n  return(df)\n}\n\nmodified_hurricane_helene_df &lt;- modify_query_df(hurricane_helene_info)\nmodified_college_football_df &lt;- modify_query_df(college_football_info)\n\n\nWith each of your resulting two data objects (each a data frame, which is a special case of a list) do the following actions:\n\n\nChoose one of your data frames. Subset the data frame to only return the date version of publishedAt and the pub_diff variables. Then use one call to the map() function to return the mean, standard deviation, and median of these columns. You should use a custom anonymous function using ‘shorthand’ notation ((x) …). Note that the pub_diff variable includes an NA so you’ll need to set na.rm = TRUE in the calls to mean(0, sd(), and median().\n\n\nlibrary(purrr)\n\n#Create a second modification function for publication times\npublish_time_stats &lt;- function(df){\n  \n  subset_df &lt;- df |&gt;\n    select(publishedAt, pub_diff)\n  \n  stats &lt;- map(subset_df, \\(x) list(mean = mean(x, na.rm = TRUE),\n                                    sd = sd(x, na.rm = TRUE),\n                                    median = median(x, na.rm = TRUE)))\n  \n  stats_df &lt;- as.data.frame(stats)\n  \n  return(stats_df)\n  \n}\n\nhurricane_helene_stats &lt;- publish_time_stats(modified_hurricane_helene_df)\nprint(hurricane_helene_stats)\n\n     publishedAt.mean publishedAt.sd  publishedAt.median pub_diff.mean\n1 2024-10-04 01:56:19       427831.6 2024-10-04 00:43:16      323.4294\n  pub_diff.sd pub_diff.median\n1     459.219        154.2833\n\ncollege_football_stats &lt;- publish_time_stats(modified_college_football_df)\nprint(college_football_stats)\n\n     publishedAt.mean publishedAt.sd  publishedAt.median pub_diff.mean\n1 2024-10-01 07:10:17       734607.6 2024-10-01 05:23:01      3077.813\n  pub_diff.sd pub_diff.median\n1    2465.205        2279.283"
  }
]